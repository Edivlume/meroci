<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>MEROCI | Asesoras Inmobiliarias</title>
  <meta name="description" content="MEROCI Asesoras Inmobiliarias: publicaci√≥n de propiedades, corretaje, valuaci√≥n y asesor√≠a integral." />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;700&display=swap" rel="stylesheet">
  <!-- Persistencia remota opcional (Supabase) -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <style>
    :root{ --primary:#8c2f3d; --primary-600:#a33a4a; --primary-700:#742635; --accent:#e8d7db; --ink:#1f2937; --muted:#6b7280; --bg:#ffffff; --card:#ffffff; --shadow:0 10px 30px rgba(0,0,0,.08); --radius:18px; }
    *{box-sizing:border-box}
    html,body{margin:0;padding:0;font-family:Outfit,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;color:var(--ink);background:var(--bg)}
    a{color:var(--primary);text-decoration:none}
    img{max-width:100%;display:block}

    /* NAV */
    .nav{position:sticky;top:0;z-index:50;background:rgba(255,255,255,.85);backdrop-filter:saturate(120%) blur(8px);border-bottom:1px solid #f1f1f1}
    .nav-inner{max-width:1200px;margin:auto;display:flex;gap:24px;align-items:center;justify-content:space-between;padding:14px 20px}
    .brand{display:flex;align-items:center;gap:12px;font-weight:700}
    .brand-logo{width:42px;height:42px;border-radius:12px;display:grid;place-items:center;background:linear-gradient(135deg,var(--primary),var(--primary-600));color:#fff;font-weight:800}
    .brand small{display:block;font-weight:600;color:var(--muted);letter-spacing:.08em}
    .menu{display:flex;gap:18px;flex-wrap:wrap}
    .menu a{padding:10px 12px;border-radius:12px;font-weight:600;color:var(--ink)}
    .menu a:hover{background:#f7f7f8}
    .cta{display:flex;gap:10px;align-items:center}
    .btn{appearance:none;border:0;border-radius:14px;padding:12px 16px;font-weight:700;cursor:pointer;transition:.2s;box-shadow:var(--shadow)}
    .btn.primary{background:var(--primary);color:#fff}
    .btn.primary:hover{background:var(--primary-700);transform:translateY(-1px)}
    .btn.ghost{background:#fff;color:var(--primary);border:2px solid var(--primary);box-shadow:none}
    .btn.ghost:hover{background:var(--accent)}

    /* HERO */
    .hero{position:relative;isolation:isolate}
    .hero::before{content:"";position:absolute;inset:0;background:radial-gradient(1200px 600px at 60% -10%, #f2e6e9, transparent 60%), linear-gradient(180deg, #ffffff, #f6edf0 55%, #ffffff 100%);z-index:-1;pointer-events:none}
    .hero-inner{max-width:1200px;margin:auto;padding:88px 20px 40px;display:grid;grid-template-columns:1.2fr .8fr;gap:40px}
    .hero .badge{background:var(--primary);color:#fff;border-radius:999px;padding:8px 14px;font-size:14px;font-weight:800;box-shadow:0 6px 20px rgba(140,47,61,.25);display:inline-block;margin-bottom:14px}
    .hero h1{font-size:clamp(36px,5vw,64px);line-height:1.03;margin:0;color:#2b2f38}
    .hero p{font-size:clamp(16px,2.1vw,20px);color:var(--muted)}
    .hero-card{background:var(--card);padding:22px;border-radius:var(--radius);box-shadow:var(--shadow);display:flex;gap:14px;align-items:center}

    /* LAYOUT */
    section{padding:56px 20px}
    .wrap{max-width:1200px;margin:auto}
    .section-head{display:flex;align-items:end;justify-content:space-between;margin-bottom:20px;gap:20px}
    .section-head h2{font-size:clamp(24px,3vw,36px);margin:0}
    .section-head p{color:var(--muted);margin:0}

    /* LISTADO */
    .filters{display:grid;grid-template-columns:repeat(6, minmax(0,1fr));gap:12px;margin:14px 0 26px}
    .field{background:#fff;border:1px solid #eee;border-radius:12px;padding:10px 12px;display:flex;align-items:center;gap:8px}
    .field input,.field select,.field textarea{border:0;outline:0;width:100%;font:inherit}
    .grid{display:grid;grid-template-columns:repeat(3, minmax(0,1fr));gap:18px}
    .card{background:var(--card);border-radius:16px;overflow:hidden;box-shadow:var(--shadow);display:flex;flex-direction:column}
    .thumb{position:relative;aspect-ratio:16/10;overflow:hidden}
    .chip{position:absolute;top:10px;left:10px;background:#fff;padding:6px 10px;border-radius:10px;font-size:12px;font-weight:800;color:var(--primary);box-shadow:var(--shadow)}
    .card-body{padding:14px 16px;display:grid;gap:6px}
    .price{font-weight:800;font-size:20px}
    .meta{color:var(--muted);font-size:14px}
    .card-actions{display:flex;gap:10px;padding:12px 16px 16px}

    /* SERVICIOS/EQUIPO */
    .services{display:grid;grid-template-columns:repeat(4, minmax(0,1fr));gap:18px;margin-top:18px}
    .svc{background:var(--card);padding:18px;border-radius:16px;box-shadow:var(--shadow)}
    .team{display:grid;grid-template-columns:repeat(2, minmax(0,1fr));gap:18px}
    .agent{display:flex;gap:14px;background:var(--card);padding:16px;border-radius:16px;box-shadow:var(--shadow);align-items:center}
    .avatar{width:64px;height:64px;border-radius:16px;background:linear-gradient(135deg,var(--primary),var(--primary-600));color:#fff;display:grid;place-items:center;font-weight:900}

    /* FOOTER */
    footer{background:#0f1115;color:#e5e7eb}
    .foot{max-width:1200px;margin:auto;display:grid;grid-template-columns:2fr 1fr 1fr;gap:20px;padding:36px 20px}
    .foot a{color:#e5e7eb}
    .copy{padding:12px 20px;border-top:1px solid rgba(255,255,255,.1);text-align:center;color:#9ca3af}

    /* MODALES */
    dialog{border:0;border-radius:18px;max-width:980px;width:96%;padding:0;overflow:hidden;box-shadow:0 20px 80px rgba(0,0,0,.25)}
    .modal-head{display:flex;justify-content:space-between;align-items:center;padding:14px 16px;border-bottom:1px solid #eee}
    .modal-body{display:grid;grid-template-columns:1.1fr .9fr}
    .modal-body .col{padding:16px}
    .gallery{aspect-ratio:16/10;border-radius:12px;overflow:hidden}
    .gallery img, .gallery video{width:100%;height:100%;object-fit:cover}

    /* REVIEWS */
    .reviews{position:relative}
    .reviews-viewport{overflow:hidden}
    .reviews-track{display:flex;gap:16px;transition:transform .5s ease}
    .review{min-width:calc(33.333% - 10.7px);background:var(--card);border-radius:16px;box-shadow:var(--shadow);padding:16px}
    .rev-head{display:flex;align-items:center;gap:10px;margin-bottom:6px}
    .rev-avatar{width:40px;height:40px;border-radius:50%;background:linear-gradient(135deg,var(--primary),var(--primary-600));color:#fff;display:grid;place-items:center;font-weight:800}
    .rev-name{font-weight:800}
    .rev-sub{color:var(--muted);font-size:13px}
    .rev-stars{font-size:14px;letter-spacing:.5px}
    .rev-text{margin:8px 0 0}
    .rev-nav{position:absolute;top:50%;transform:translateY(-50%);border:0;background:#fff;border-radius:999px;box-shadow:var(--shadow);width:38px;height:38px;font-size:20px;font-weight:800;cursor:pointer}
    .rev-nav.prev{left:-6px}
    .rev-nav.next{right:-6px}
    .rev-dots{display:flex;gap:8px;justify-content:center;margin-top:12px}
    .rev-dots button{width:8px;height:8px;border-radius:999px;border:0;background:#e5e7eb}
    .rev-dots button.active{background:var(--primary)}

    /* RESPONSIVE */
    @media (max-width:1024px){ .grid{grid-template-columns:repeat(2, minmax(0,1fr))} .services{grid-template-columns:repeat(2, minmax(0,1fr))} .hero-inner{grid-template-columns:1fr} .modal-body{grid-template-columns:1fr} .review{min-width:calc(50% - 8px)} }
    @media (max-width:640px){ .menu{display:none} .filters{grid-template-columns:repeat(2, minmax(0,1fr))} .grid{grid-template-columns:1fr} .team{grid-template-columns:1fr} .foot{grid-template-columns:1fr} .review{min-width:100%} }
  </style>
</head>
<body>
  <header class="nav">
    <div class="nav-inner">
      <a class="brand" href="#">
  <img src="logo-meroci.png" alt="Logo MEROCI" style="width:42px;height:42px;border-radius:12px;">
  <div>MEROCI<br><small>ASESORAS INMOBILIARIAS</small></div>
</a>
      <nav class="menu">
        <a href="#propiedades">Propiedades</a>
        <a href="#servicios">Servicios</a>
        <a href="#equipo">Equipo</a>
        <a href="#contacto">Contacto</a>
        <a href="https://www.inmuebles24.com/inmobiliarias/luz-lugo_50313017-inmuebles.html" target="_blank" rel="noopener">Inmuebles24</a>
        <a href="#" id="btn-admin">Admin</a>
      </nav>
      <div class="cta">
        <a class="btn ghost" href="https://wa.me/525530297418" target="_blank" rel="noopener">WhatsApp</a>
        <a class="btn primary" href="#contacto">Publica tu propiedad</a>
      </div>
    </div>
  </header>

  <section class="hero">
    <div class="hero-inner">
      <div>
        <span class="badge">Confianza ‚Ä¢ Claridad ‚Ä¢ Cierre</span>
        <h1>Encuentra tu pr√≥ximo hogar <span style="color:var(--primary)">con MEROCI</span></h1>
        <p>Somos asesoras inmobiliarias que acompa√±an todo el proceso: valoraci√≥n, promoci√≥n, negociaci√≥n y firma. Publica con nosotras o descubre propiedades verificadas.</p>
        <div class="hero-card" style="align-items:center;gap:16px"><div style="font-weight:800;display:flex;align-items:center;gap:8px">üîé B√∫squeda asistida</div><span style="color:var(--muted)">Cu√©ntanos qu√© necesitas y te enviamos opciones en horas.</span></div>
      </div>
      <div>
        <div class="hero-card">
          <div style="flex:1">
            <div style="display:flex;align-items:center;gap:10px;margin-bottom:6px"><div class="avatar" aria-hidden>üè†</div><div><div style="font-weight:800">Publicaci√≥n premium</div><div style="color:var(--muted);font-size:14px">Fotos pro, copy comercial y difusi√≥n multicanal.</div></div></div>
            <div style="display:flex;align-items:center;gap:10px"><div class="avatar" aria-hidden>üñäÔ∏è</div><div><div style="font-weight:800">Cierre sin estr√©s</div><div style="color:var(--muted);font-size:14px">Revisi√≥n legal y acompa√±amiento hasta escrituraci√≥n.</div></div></div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <section id="propiedades">
    <div class="wrap">
      <div class="section-head"><div><h2>Propiedades destacadas</h2><p>Filtra por tipo, estado, ciudad y presupuesto.</p></div></div>
      <div class="filters">
        <label class="field"><span>üîé</span><input id="q" placeholder="Buscar por calle, colonia..." /></label>
        <label class="field"><span>üè∑Ô∏è</span><select id="tipo"><option value="">Tipo</option><option>Casa</option><option>Departamento</option><option>Terreno</option><option>Local</option></select></label>
        <label class="field"><span>üó∫Ô∏è</span><select id="estado"><option value="">Estado</option></select></label>
        <label class="field"><span>üìç</span><select id="ciudad"><option value="">Ciudad / Municipio</option></select></label>
        <label class="field"><span>$</span><input id="min" type="number" placeholder="M√≠n" min="0" /></label>
        <label class="field"><span>$</span><input id="max" type="number" placeholder="M√°x" min="0" /></label>
      </div>
      <div id="cards" class="grid"></div>
    </div>
  </section>

  <section id="servicios" style="background:linear-gradient(0deg,#fff, #fff 60%, #f9f5f6);">
    <div class="wrap">
      <div class="section-head"><div><h2>Servicios</h2><p>Soluciones integrales para vender, comprar o rentar.</p></div></div>
      <div class="services">
        <div class="svc"><div class="badge">Vendedores</div><h3>Comercializaci√≥n 360¬∞</h3><p style="color:var(--muted)">An√°lisis comparativo, estrategia de precio, producci√≥n de fotos/video, publicaci√≥n multicanal, filtros de interesados y negociaciones.</p></div>
        <div class="svc"><div class="badge">Compradores</div><h3>B√∫squeda a la medida</h3><p style="color:var(--muted)">Ruta personalizada por ubicaci√≥n, presupuesto y plusval√≠a. Agendamos visitas y te guiamos hasta el cierre.</p></div>
        <div class="svc"><div class="badge">Legal</div><h3>Gesti√≥n y escrituraci√≥n</h3><p style="color:var(--muted)">Revisi√≥n jur√≠dica, arrendamientos, promesas, cr√©ditos, acompa√±amiento con notar√≠a y entrega.</p></div>
        <div class="svc"><div class="badge">Valuaci√≥n</div><h3>Estimaci√≥n de valor</h3><p style="color:var(--muted)">Opini√≥n de valor de mercado para fijar el mejor precio de salida.</p></div>
      </div>
    </div>
  </section>

  <section id="equipo">
    <div class="wrap">
      <div class="section-head"><div><h2>Nuestro equipo</h2><p>Atenci√≥n cercana y resultados.</p></div></div>
      <div class="team">
        <div class="agent"><div class="avatar">LI</div><div><div style="font-weight:800">Luz Imelda Meza Ch√°vez</div><div style="color:var(--muted)">Asesora inmobiliaria</div><div style="margin-top:6px;display:flex;gap:10px;flex-wrap:wrap"><a class="btn ghost" href="tel:+525530297418">üìû 55 3029 7418</a><a class="btn primary" href="https://wa.me/525530297418" target="_blank" rel="noopener">WhatsApp</a></div></div></div>
        <div class="agent"><div class="avatar">CR</div><div><div style="font-weight:800">Claudia Rodr√≠guez Guevara</div><div style="color:var(--muted)">Asesora inmobiliaria</div><div style="margin-top:6px;display:flex;gap:10px;flex-wrap:wrap"><a class="btn ghost" href="tel:+525554149125">üìû 55 5414 9125</a><a class="btn primary" href="https://wa.me/525554149125" target="_blank" rel="noopener">WhatsApp</a></div></div></div>
      </div>
    </div>
  </section>

  <section id="contacto" style="background:#faf7f8">
    <div class="wrap">
      <div class="section-head"><div><h2>Hablemos</h2><p>Cu√©ntanos qu√© buscas o publica tu propiedad.</p></div></div>
      <div class="grid" style="grid-template-columns:1.1fr .9fr">
        <form id="form" class="svc" style="box-shadow:var(--shadow)">
          <label class="field" style="margin-bottom:10px"><input name="nombre" placeholder="Nombre*" required></label>
          <label class="field" style="margin-bottom:10px"><input name="email" type="email" placeholder="Email*" required></label>
          <label class="field" style="margin-bottom:10px"><input name="telefono" placeholder="Tel√©fono*" required></label>
          <label class="field" style="margin-bottom:10px"><select name="interes" required><option value="">¬øQu√© te interesa?</option><option>Comprar</option><option>Vender</option><option>Rentar</option></select></label>
          <label class="field" style="margin-bottom:10px"><input name="zona" placeholder="Zona de inter√©s / Colonia"></label>
          <label class="field" style="margin-bottom:10px"><input name="presupuesto" placeholder="Presupuesto (MXN)"></label>
          <label class="field" style="margin-bottom:10px"><textarea name="mensaje" rows="4" placeholder="Cu√©ntanos m√°s"></textarea></label>
          <div style="display:flex;gap:12px;flex-wrap:wrap"><button class="btn primary" type="submit">Enviar</button><a class="btn ghost" href="mailto:meroci1629@gmail.com">Escribir por correo</a></div>
          <p style="color:var(--muted);margin-top:10px">Tambi√©n puedes escribirnos a <a href="mailto:meroci1629@gmail.com">meroci1629@gmail.com</a></p>
        </form>
        <div class="svc" style="box-shadow:var(--shadow)"><h3 style="margin-top:0">Oficinas</h3><p style="color:var(--muted)">Atendemos CDMX y zonas conurbadas. Citas previa agenda.</p><div style="display:grid;gap:8px"><div class="hero-card"><strong>Tel√©fono</strong><span>55 3029 7418 ‚Ä¢ 55 5414 9125</span></div><div class="hero-card"><strong>Correo</strong><span>meroci1629@gmail.com</span></div><div class="hero-card"><strong>Horario</strong><span>Lunes a s√°bado ¬∑ 9:00‚Äì19:00</span></div></div></div>
      </div>
    </div>
  </section>

  <section id="testimonios" style="background:#fff">
    <div class="wrap">
      <div class="section-head"><div><h2>Opiniones de clientes</h2><p>Experiencias reales y verificadas.</p></div></div>
      <div class="reviews">
        <button class="rev-nav prev" aria-label="Anterior">‚Äπ</button>
        <div class="reviews-viewport"><div id="reviews-track" class="reviews-track"></div></div>
        <button class="rev-nav next" aria-label="Siguiente">‚Ä∫</button>
      </div>
      <div id="reviews-dots" class="rev-dots"></div>
    </div>
  </section>

  <footer>
    <div class="foot">
 <div class="brand" style="color:#fff">
  <img src="img/logo-meroci.png" alt="Logo MEROCI" style="width:42px;height:42px;border-radius:12px;">
  <div>MEROCI<br><small style="color:#e5e7eb">ASESORAS INMOBILIARIAS</small></div>
</div>
      <div><h4>Contacto</h4><p style="margin:6px 0">üìû 55 3029 7418</p><p style="margin:6px 0">üìû 55 5414 9125</p><p style="margin:6px 0">‚úâÔ∏è <a href="mailto:meroci1629@gmail.com">meroci1629@gmail.com</a></p><p style="margin:6px 0"><a href="https://www.inmuebles24.com/inmobiliarias/luz-lugo_50313017-inmuebles.html" target="_blank" rel="noopener">Perfil en Inmuebles24</a></p></div>
      <div><h4>Enlaces</h4><p><a href="#propiedades">Propiedades</a></p><p><a href="#servicios">Servicios</a></p><p><a href="#equipo">Equipo</a></p><p><a href="#contacto">Contacto</a></p></div>
    </div>
    <div class="copy">¬© <span id="yy"></span> MEROCI. Todos los derechos reservados.</div>
  </footer>

  <!-- Modal de propiedad -->
  <dialog id="modal">
    <div class="modal-head"><strong id="m-title">T√≠tulo</strong><button class="btn ghost" onclick="closeModal()">Cerrar</button></div>
    <div class="modal-body">
      <div class="col">
        <div class="gallery"><img id="m-img" alt=""><video id="m-video" controls style="display:none"></video></div>
        <div id="m-tags" style="margin-top:10px;display:flex;gap:8px;flex-wrap:wrap"></div>
      </div>
      <div class="col">
        <div class="price" id="m-price"></div>
        <div class="meta" id="m-meta" style="margin:6px 0 12px"></div>
        <p id="m-desc"></p>
        <div class="card-actions">
          <a id="m-whats" class="btn primary" target="_blank" rel="noopener">Agendar visita</a>
          <a id="m-more" class="btn ghost" target="_blank" rel="noopener">Quiero m√°s info</a>
          <a id="m-i24" class="btn ghost" target="_blank" rel="noopener" style="display:none">Ver en Inmuebles24</a>
        </div>
      </div>
    </div>
  </dialog>

  <!-- Panel de Administraci√≥n -->
  <dialog id="admin">
    <div class="modal-head"><strong>Administrador MEROCI</strong><button class="btn ghost" onclick="document.getElementById('admin').close()">Cerrar</button></div>
    <div class="modal-body" style="grid-template-columns:1fr">
      <div class="col">
        <div id="admin-login" class="svc" style="margin-bottom:14px"><h3 style="margin-top:0">Ingresar</h3><label class="field" style="margin-bottom:10px"><input id="admin-user" placeholder="Usuario" value="admin"></label><label class="field" style="margin-bottom:10px"><input id="admin-pass" type="password" placeholder="Contrase√±a"></label><button class="btn primary" id="admin-login-btn">Entrar</button><p style="color:var(--muted);margin-top:8px">* Seguridad b√°sica en el navegador. Para producci√≥n se recomienda backend.</p></div>
        <div id="admin-app" style="display:none">
          <div class="hero-card" style="justify-content:space-between"><strong>Gestor de propiedades</strong><div style="display:flex;gap:8px"><button class="btn ghost" id="admin-logout-btn">Cerrar sesi√≥n</button><button class="btn primary" id="nuevo-btn">Nueva propiedad</button></div></div>
          <div id="admin-form" class="svc" style="margin-top:12px;display:none">
            <h3 id="form-title" style="margin:0 0 10px">Nueva propiedad</h3>
            <div style="display:grid;grid-template-columns:repeat(3, minmax(0,1fr));gap:10px">
              <label class="field"><input id="f-id" placeholder="ID (auto)" disabled></label>
              <label class="field"><input id="f-titulo" placeholder="T√≠tulo*" required></label>
              <label class="field"><select id="f-tipo"><option>Casa</option><option>Departamento</option><option>Terreno</option><option>Local</option></select></label>
              <label class="field"><select id="f-estado"></select></label>
              <label class="field"><select id="f-ciudad"></select></label>
              <label class="field"><input id="f-colonia" placeholder="Colonia"></label>
              <label class="field"><input id="f-precio" type="number" placeholder="Precio (MXN)"></label>
              <label class="field"><input id="f-m2" type="number" placeholder="m¬≤"></label>
              <label class="field"><input id="f-rec" type="number" placeholder="Rec√°maras"></label>
              <label class="field"><input id="f-ban" type="number" placeholder="Ba√±os"></label>
              <label class="field"><input id="f-est" type="number" placeholder="Estacionamientos"></label>
              <label class="field"><input id="f-img" placeholder="URL de imagen principal*"></label>
              <label class="field"><input id="f-video" placeholder="URL de video (opcional)"></label>
              <label class="field"><input id="f-i24" placeholder="URL Inmuebles24 (opcional)"></label>
            </div>
            <label class="field" style="margin:10px 0"><textarea id="f-desc" rows="3" placeholder="Descripci√≥n"></textarea></label>
            <label style="display:flex;align-items:center;gap:8px;margin-bottom:10px"><input id="f-destacado" type="checkbox" checked> Mostrar en Destacadas</label>
            <div style="display:flex;gap:10px;flex-wrap:wrap"><button class="btn primary" id="guardar-prop">Guardar</button><button class="btn ghost" id="cancelar-prop">Cancelar</button></div>
          </div>
          <div class="svc" style="margin-top:12px"><div style="overflow:auto"><table id="tabla" style="width:100%;border-collapse:collapse"><thead><tr style="text-align:left"><th style="padding:8px">T√≠tulo</th><th>Tipo</th><th>Ubicaci√≥n</th><th>Precio</th><th>Destacado</th><th>Acciones</th></tr></thead><tbody></tbody></table></div></div>
        </div>
      </div>
    </div>
  </dialog>

  <script>
    // ==== UTIL ====
    const $$ = (sel, ctx=document) => ctx.querySelector(sel);
    const $$$ = (sel, ctx=document) => Array.from(ctx.querySelectorAll(sel));
    const money = v => '$' + Number(v||0).toLocaleString('es-MX') + ' MXN';

    // ==== CONFIG REMOTA (opcional) ====
    // Rellena estas dos constantes para activar persistencia multi-dispositivo
    // (crea un proyecto en supabase.com, tabla "propiedades" y pega aqu√≠ tus claves)
    const SUPABASE_URL = '';
    const SUPABASE_ANON_KEY = '';
    let sb = null;
    try{ if(SUPABASE_URL && SUPABASE_ANON_KEY && window.supabase){ sb = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY); } }catch(e){}

    const RemoteStore = {
      enabled: ()=> !!sb,
      async list(){ if(!sb) return []; const { data, error } = await sb.from('propiedades').select('*'); if(error){ console.warn('Supabase list error', error); return []; } return Array.isArray(data)? data : []; },
      async upsert(obj){ if(!sb) return; const { error } = await sb.from('propiedades').upsert(obj, { onConflict:'id' }); if(error) console.warn('Supabase upsert error', error); },
      async remove(id){ if(!sb) return; const { error } = await sb.from('propiedades').delete().eq('id', id); if(error) console.warn('Supabase delete error', error); }
    };

    // A√±o en footer
    $$('#yy').textContent = new Date().getFullYear();

    // ==== CAT√ÅLOGOS ====
    const CATALOGOS = { estados:["Aguascalientes","Baja California","Baja California Sur","Campeche","Chiapas","Chihuahua","Ciudad de M√©xico","Coahuila","Colima","Durango","Guanajuato","Guerrero","Hidalgo","Jalisco","M√©xico","Michoac√°n","Morelos","Nayarit","Nuevo Le√≥n","Oaxaca","Puebla","Quer√©taro","Quintana Roo","San Luis Potos√≠","Sinaloa","Sonora","Tabasco","Tamaulipas","Tlaxcala","Veracruz","Yucat√°n","Zacatecas"], ciudades:{
      "Ciudad de M√©xico":["√Ålvaro Obreg√≥n","Azcapotzalco","Benito Ju√°rez","Coyoac√°n","Cuajimalpa","Cuauht√©moc","Gustavo A. Madero","Iztacalco","Iztapalapa","La Magdalena Contreras","Miguel Hidalgo","Milpa Alta","Tl√°huac","Tlalpan","Venustiano Carranza","Xochimilco"],
      "M√©xico":["Ecatepec","Naucalpan","Tlalnepantla","Atizap√°n de Zaragoza","Toluca","Metepec","Cuautitl√°n Izcalli"],
      "Jalisco":["Guadalajara","Zapopan","Tlaquepaque","Tlajomulco"],
      "Nuevo Le√≥n":["Monterrey","San Pedro Garza Garc√≠a","Guadalupe","Apodaca"]
    } };
    // Intentar cargar todos los municipios/alcald√≠as desde archivo opcional
    (async function(){
      try{
        const r = await fetch('municipios-mx.json');
        if(r.ok){ const data = await r.json(); if(Array.isArray(data.estados)) CATALOGOS.estados = data.estados; if(data.ciudades) CATALOGOS.ciudades = data.ciudades; }
      }catch(e){}
      poblarEstados(); poblarCiudades();
      // Nota: el formulario Admin rellena sus cat√°logos tras login
    })();

    const elQ=$$('#q'), elTipo=$$('#tipo'), elEstado=$$('#estado'), elCiudad=$$('#ciudad'), elMin=$$('#min'), elMax=$$('#max'), elCards=$$('#cards');

    function poblarEstados(){ elEstado.innerHTML = '<option value="">Estado</option>' + CATALOGOS.estados.map(e=>`<option>${e}</option>`).join(''); }
    function poblarCiudades(){ const est=elEstado.value; let ciudades=[]; if(est){ ciudades=CATALOGOS.ciudades[est]||[]; } else { const set=new Set(); Object.values(CATALOGOS.ciudades).flat().forEach(c=>set.add(c)); ciudades=[...set]; } elCiudad.innerHTML = '<option value="">Ciudad / Municipio</option>' + ciudades.sort().map(c=>`<option>${c}</option>`).join(''); }
    elEstado.addEventListener('change', poblarCiudades);

    // ==== INVENTARIO (demo + LS + Remoto opcional) ====
    let INVENTARIO = [
      { id:'casa-condesa', titulo:'Casa con terraza en La Condesa', tipo:'Casa', estado:'Ciudad de M√©xico', ciudad:'Miguel Hidalgo', colonia:'Condesa', precio:14500000, m2:210, rec:3, ban:3, est:2, img:'https://images.unsplash.com/photo-1502005229762-cf1b2da7c52f?q=80&w=1500&auto=format&fit=crop', video:'', i24:'', destacado:true, desc:'Arquitectura de autor con terraza arbolada, iluminaci√≥n natural y distribuci√≥n abierta. A pasos de parques y restaurantes.' },
      { id:'depa-santa-fe', titulo:'Departamento con amenidades ‚Äì Santa Fe', tipo:'Departamento', estado:'Ciudad de M√©xico', ciudad:'Cuajimalpa', colonia:'Santa Fe', precio:6200000, m2:95, rec:2, ban:2, est:2, img:'https://images.unsplash.com/photo-1505692794403-34d4982f88aa?q=80&w=1500&auto=format&fit=crop', video:'', i24:'', destacado:true, desc:'Vista panor√°mica, cocina abierta, family y balc√≥n. Torre con gym, alberca y seguridad 24/7.' },
      { id:'loft-centro-mty', titulo:'Loft moderno en el Centro ‚Äì Monterrey', tipo:'Departamento', estado:'Nuevo Le√≥n', ciudad:'Monterrey', colonia:'Centro', precio:2890000, m2:58, rec:1, ban:1, est:1, img:'https://images.unsplash.com/photo-1505691938895-1758d7feb511?q=80&w=1500&auto=format&fit=crop', video:'', i24:'', destacado:true, desc:'Loft amueblado ideal para inversionistas. Alta demanda para renta a ejecutivos.' },
      { id:'terreno-zapopan', titulo:'Terreno en coto ‚Äì Zapopan', tipo:'Terreno', estado:'Jalisco', ciudad:'Zapopan', colonia:'Zapopan Norte', precio:2150000, m2:160, rec:0, ban:0, est:0, img:'https://images.unsplash.com/photo-1460353581641-37baddab0fa2?q=80&w=1500&auto=format&fit=crop', video:'', i24:'', destacado:false, desc:'Terreno regular en fraccionamiento con control de acceso, √°reas verdes y casa club.' },
      { id:'local-polanco', titulo:'Local con gran frente ‚Äì Polanco', tipo:'Local', estado:'Ciudad de M√©xico', ciudad:'Miguel Hidalgo', colonia:'Polanco', precio:9800000, m2:75, rec:0, ban:1, est:0, img:'https://images.unsplash.com/photo-1529429612777-7125f0e82c73?q=80&w=1500&auto=format&fit=crop', video:'', i24:'', destacado:true, desc:'Excelente ubicaci√≥n comercial, alto flujo peatonal y vehicular. Ideal boutique o caf√©.' },
      { id:'ph-roma', titulo:'PH con roof garden ‚Äì Roma Norte', tipo:'Departamento', estado:'Ciudad de M√©xico', ciudad:'Cuauht√©moc', colonia:'Roma Norte', precio:8750000, m2:125, rec:2, ban:2, est:2, img:'https://images.unsplash.com/photo-1499914485622-a88fac536970?q=80&w=1500&auto=format&fit=crop', video:'', i24:'', destacado:true, desc:'Penthouse de doble altura con roof privado y acabados premium. Proyecto pet-friendly.' }
    ];
    const LS_KEY='meroci:props';
    try{ const fromLS=JSON.parse(localStorage.getItem(LS_KEY)||'[]'); const map=new Map(); [...INVENTARIO,...fromLS].forEach(p=>map.set(p.id,p)); INVENTARIO=[...map.values()]; }catch(e){}

    async function syncFromRemote(){ if(!RemoteStore.enabled()) return; const remote = await RemoteStore.list(); if(remote.length){ const map=new Map(); [...INVENTARIO,...remote].forEach(p=>map.set(p.id,p)); INVENTARIO=[...map.values()]; } }

    // ==== LISTADO ====
    function render(list){
      elCards.innerHTML='';
      if(!list.length){ elCards.innerHTML='<div class="svc" style="grid-column:1/-1;text-align:center">Sin resultados. Ajusta filtros o <a href="#contacto">cont√°ctanos</a>.</div>'; return; }
      list.forEach(p=>{
        const card=document.createElement('article'); card.className='card';
        const videoBadge = p.video? '<div class="chip">üé¨ Video</div>' : '';
        card.innerHTML=`<div class="thumb"><img src="${p.img}" alt="${p.titulo}"><div class="chip">${p.tipo}</div>${videoBadge}</div>
          <div class="card-body"><div class="price">${money(p.precio)}</div><div style="font-weight:700">${p.titulo}</div>
          <div class="meta">${p.ciudad} ‚Ä¢ ${p.colonia} ‚Ä¢ ${p.m2} m¬≤ ‚Ä¢ ${p.rec} rec ‚Ä¢ ${p.ban} ba√±o(s)</div></div>
          <div class="card-actions"><button class="btn primary" data-open="${p.id}">Ver detalles</button>
          <a class="btn ghost" href="https://wa.me/525530297418?text=Hola%20MEROCI,%20quiero%20informaci√≥n%20sobre:%20${encodeURIComponent(p.titulo)}" target="_blank" rel="noopener">WhatsApp</a></div>`;
        elCards.appendChild(card);
      });
    }
    function applyFilters(){
      const q=(elQ.value||'').toLowerCase(), tipo=elTipo.value, estado=elEstado.value, ciudad=elCiudad.value;
      const min=parseInt(elMin.value||0,10), max=parseInt(elMax.value||1e12,10);
      const list = INVENTARIO.filter(p=>p.destacado!==false).filter(p=>{
        const matchQ=[p.titulo,p.colonia,p.ciudad,p.tipo].join(' ').toLowerCase().includes(q);
        const matchTipo=!tipo||p.tipo===tipo; const matchEstado=!estado||p.estado===estado; const matchCiudad=!ciudad||p.ciudad===ciudad; const matchPrecio=p.precio>=min&&p.precio<=max; return matchQ&&matchTipo&&matchEstado&&matchCiudad&&matchPrecio; });
      render(list);
    }
    [elQ,elTipo,elEstado,elCiudad,elMin,elMax].forEach(el=> el.addEventListener('input', applyFilters));

    // ==== MODAL DE PROPIEDAD ====
    const modal=$$('#modal'), mImg=$$('#m-img'), mVideo=$$('#m-video');
    function openModal(id){ const p=INVENTARIO.find(x=>x.id===id); if(!p) return; $$('#m-title').textContent=p.titulo; mImg.src=p.img; mImg.style.display=p.video?'none':'block'; mVideo.src=p.video||''; mVideo.style.display=p.video?'block':'none'; $$('#m-price').textContent=money(p.precio); $$('#m-meta').textContent=`${p.ciudad} ‚Ä¢ ${p.colonia} ‚Ä¢ ${p.m2} m¬≤ ‚Ä¢ ${p.rec} rec ‚Ä¢ ${p.ban} ba√±o(s)`; $$('#m-desc').textContent=p.desc||''; const whatsVisita=`https://wa.me/525530297418?text=${encodeURIComponent('Hola MEROCI, quiero agendar visita para: '+p.titulo)}`; const whatsInfo=`https://wa.me/525530297418?text=${encodeURIComponent('Hola MEROCI, quiero m√°s informaci√≥n de: '+p.titulo)}`; $$('#m-whats').href=whatsVisita; const more=$$('#m-more'); more.href=whatsInfo; const mi24=$$('#m-i24'); if(p.i24){ mi24.style.display='inline-flex'; mi24.href=p.i24; } else { mi24.style.display='none'; mi24.removeAttribute('href'); }
      const tags=$$('#m-tags'); tags.innerHTML=''; ['Estado: '+(p.estado||''),'Ubicaci√≥n: '+p.ciudad,'Tipo: '+p.tipo, p.m2+' m¬≤'].forEach(t=>{ const b=document.createElement('span'); b.className='chip'; b.textContent=t; tags.appendChild(b); }); modal.showModal(); }
    function closeModal(){ modal.close(); }
    window.openModal=openModal; window.closeModal=closeModal;

    // ==== ADMIN ====
    const ADMIN_PASS='meroci2025';
    const adminDlg=$$('#admin');
    $$('#btn-admin').addEventListener('click',(e)=>{ e.preventDefault(); adminDlg.showModal(); });
    $$('#admin-login-btn').addEventListener('click',()=>{ const pass=$$('#admin-pass').value; if(pass===ADMIN_PASS){ $$('#admin-login').style.display='none'; $$('#admin-app').style.display='block'; renderTabla(); fillCatalogosForm(); } else { alert('Contrase√±a incorrecta'); } });
    $$('#admin-logout-btn').addEventListener('click',()=>{ $$('#admin-app').style.display='none'; $$('#admin-login').style.display='block'; $$('#admin-pass').value=''; });

    const tbody=$$('#tabla tbody');
    const f = { id: $$('#f-id'), titulo: $$('#f-titulo'), tipo: $$('#f-tipo'), estado: $$('#f-estado'), ciudad: $$('#f-ciudad'), colonia: $$('#f-colonia'), precio: $$('#f-precio'), m2: $$('#f-m2'), rec: $$('#f-rec'), ban: $$('#f-ban'), est: $$('#f-est'), img: $$('#f-img'), video: $$('#f-video'), i24: $$('#f-i24'), desc: $$('#f-desc'), destacado: $$('#f-destacado') };

    function fillCatalogosForm(){ if(!f.estado || !f.ciudad) return; f.estado.innerHTML=CATALOGOS.estados.map(e=>`<option>${e}</option>`).join(''); f.estado.onchange=()=>{ const cs=CATALOGOS.ciudades[f.estado.value]||[]; f.ciudad.innerHTML=cs.map(c=>`<option>${c}</option>`).join(''); }; f.estado.value='Ciudad de M√©xico'; f.estado.dispatchEvent(new Event('change')); f.ciudad.value='Cuauht√©moc'; }

    function mostrarForm(data){ $$('#admin-form').style.display='block'; $$('#form-title').textContent=data?'Editar propiedad':'Nueva propiedad'; editId=data?data.id:null; f.id.value=data?data.id:''; f.titulo.value=data?data.titulo:''; f.tipo.value=data?data.tipo:'Casa'; f.estado.value=data?data.estado:'Ciudad de M√©xico'; f.estado.dispatchEvent(new Event('change')); f.ciudad.value=data?data.ciudad:'Cuauht√©moc'; f.colonia.value=data?data.colonia:''; f.precio.value=data?data.precio:''; f.m2.value=data?data.m2:''; f.rec.value=data?data.rec:''; f.ban.value=data?data.ban:''; f.est.value=data?data.est:''; f.img.value=data?data.img:''; f.video.value=data?data.video:''; f.i24.value=data?(data.i24||''):''; f.desc.value=data?data.desc:''; f.destacado.checked=data?!!data.destacado:true; }
    function ocultarForm(){ $$('#admin-form').style.display='none'; editId=null; }

    function renderTabla(){ tbody.innerHTML=''; INVENTARIO.forEach(p=>{ const tr=document.createElement('tr'); tr.innerHTML=`<td style="padding:8px;border-bottom:1px solid #eee">${p.titulo}</td><td style="border-bottom:1px solid #eee">${p.tipo}</td><td style="border-bottom:1px solid #eee">${p.estado||''} / ${p.ciudad||''} / ${p.colonia||''}</td><td style="border-bottom:1px solid #eee">${money(p.precio)}</td><td style="border-bottom:1px solid #eee">${p.destacado?'S√≠':'No'}</td><td style="border-bottom:1px solid #eee"><button class="btn ghost" data-editar="${p.id}">Editar</button> <button class="btn primary" data-eliminar="${p.id}">Eliminar</button></td>`; tbody.appendChild(tr); }); $$$('[data-editar]',tbody).forEach(b=> b.addEventListener('click',()=>{ const p=INVENTARIO.find(x=>x.id===b.getAttribute('data-editar')); mostrarForm(p); })); $$$('[data-eliminar]',tbody).forEach(b=> b.addEventListener('click',async ()=>{ const id=b.getAttribute('data-eliminar'); if(confirm('¬øEliminar esta propiedad?')){ INVENTARIO=INVENTARIO.filter(p=>p.id!==id); persistOnlyCustom(); if(RemoteStore.enabled()) await RemoteStore.remove(id); renderTabla(); applyFilters(); } })); }

    let editId=null;
    $$('#nuevo-btn').addEventListener('click',()=> mostrarForm());
    $$('#cancelar-prop').addEventListener('click',()=> ocultarForm());
    $$('#guardar-prop').addEventListener('click',async ()=>{
      const obj={ id: editId||slug(f.titulo.value)+'-'+Date.now().toString().slice(-5), titulo:f.titulo.value, tipo:f.tipo.value, estado:f.estado.value, ciudad:f.ciudad.value, colonia:f.colonia.value, precio:Number(f.precio.value||0), m2:Number(f.m2.value||0), rec:Number(f.rec.value||0), ban:Number(f.ban.value||0), est:Number(f.est.value||0), img:f.img.value, video:f.video.value, i24:f.i24.value, desc:f.desc.value, destacado:!!f.destacado.checked };
      if(!obj.titulo||!obj.img){ alert('T√≠tulo e imagen son obligatorios'); return; }
      if(editId){ INVENTARIO = INVENTARIO.map(p=> p.id===editId? obj : p); } else { INVENTARIO.unshift(obj); }
      persistOnlyCustom();
      if(RemoteStore.enabled()) await RemoteStore.upsert(obj);
      ocultarForm(); renderTabla(); poblarCiudades(); applyFilters();
    });

    function persistOnlyCustom(){ const demo=new Set(['casa-condesa','depa-santa-fe','loft-centro-mty','terreno-zapopan','local-polanco','ph-roma']); const custom=INVENTARIO.filter(p=>!demo.has(p.id)); localStorage.setItem(LS_KEY, JSON.stringify(custom)); }
    function slug(s){ return (s||'').toLowerCase().normalize('NFD').replace(/[\u0300-\u036f]/g,'').replace(/[^a-z0-9]+/g,'-').replace(/(^-|-$)/g,''); }

    // ==== FORM CONTACTO ====
    $$('#form').addEventListener('submit',(e)=>{ e.preventDefault(); const data=new FormData(e.target); const params=[...data.entries()].map(([k,v])=>`*${k}*: ${v}`).join('%0A'); window.location.href=`mailto:meroci1629@gmail.com?subject=Contacto%20desde%20web%20MEROCI&body=${params}`; });

    // ==== TESTIMONIOS (7 items) ====
    const REVIEWS=[
      {name:'Mar√≠a L.', city:'Roma Norte, CDMX', type:'Venta', stars:5, text:'Imelda nos llev√≥ de la mano en todo: valoraci√≥n y notar√≠a. Vendimos arriba de lo esperado.'},
      {name:'Javier & Sof√≠a', city:'Guadalajara, Jal.', type:'Compra', stars:5, text:'Claudia entendi√≥ nuestro presupuesto y zona. Cerramos en dos semanas.'},
      {name:'Alejandra R.', city:'Polanco, CDMX', type:'Renta', stars:5, text:'Negoci√≥ mantenimiento y fechas flexibles. ¬°Cero estr√©s!'},
      {name:'Carlos M.', city:'San Pedro, NL', type:'Compra', stars:4, text:'Visitas coordinadas y pros/contras claros con Imelda.'},
      {name:'Paola G.', city:'Toluca, Edo. M√©x.', type:'Venta', stars:5, text:'Regularizaron papeles antes de publicar. Cierre sin contratiempos.'},
      {name:'Patricia D.', city:'Benito Ju√°rez, CDMX', type:'Renta', stars:5, text:'Solo visitas calificadas. Gracias, Claudia.'},
      {name:'Esteban N.', city:'Quer√©taro, Qro.', type:'Compra', stars:5, text:'Imelda y Claudia nos guiaron a distancia hasta la firma.'}
    ];
    function starHTML(n){ return '‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ'.slice(0,n)+'‚òÜ‚òÜ‚òÜ‚òÜ‚òÜ'.slice(0,5-n); }
    function renderReviews(){ const track=$$('#reviews-track'); if(!track) return; track.innerHTML=''; REVIEWS.forEach(r=>{ const el=document.createElement('article'); el.className='review'; const ini=r.name.split(' ').map(w=>w[0]).join('').slice(0,2).toUpperCase(); el.innerHTML=`<div class="rev-head"><div class="rev-avatar">${ini}</div><div><div class="rev-name">${r.name}</div><div class="rev-sub">${r.city} ‚Ä¢ ${r.type}</div><div class="rev-stars" aria-label="${r.stars} de 5">${starHTML(r.stars)}</div></div></div><p class="rev-text">‚Äú${r.text}‚Äù</p>`; track.appendChild(el); }); buildDots(); updateReviews(); }
    let revIndex=0, timer; function perView(){ if(matchMedia('(max-width:640px)').matches) return 1; if(matchMedia('(max-width:1024px)').matches) return 2; return 3; }
    function pages(){ const track=$$('#reviews-track'); return Math.max(1, Math.ceil(track.children.length / perView())); }
    function updateReviews(){ const track=$$('#reviews-track'); const card=track.querySelector('.review'); if(card){ const w=card.getBoundingClientRect().width+16; track.style.transform=`translateX(${-revIndex*w*perView()}px)`; } const dots=$$$('#reviews-dots button'); dots.forEach((d,i)=> d.classList.toggle('active', i===revIndex)); clearInterval(timer); timer=setInterval(()=>{ revIndex=(revIndex+1)%pages(); updateReviews(); }, 5000); }
    function buildDots(){ const dots=$$('#reviews-dots'); dots.innerHTML=''; const pg=pages(); for(let i=0;i<pg;i++){ const b=document.createElement('button'); if(i===0) b.classList.add('active'); b.addEventListener('click',()=>{ revIndex=i; updateReviews(); }); dots.appendChild(b); } }
    document.addEventListener('click',(e)=>{ if(e.target.classList && e.target.classList.contains('rev-nav')){ revIndex=(revIndex+(e.target.classList.contains('next')?1:-1)+pages())%pages(); updateReviews(); } });

    // ==== INICIALIZACI√ìN ====
    async function init(){ await syncFromRemote(); render(INVENTARIO.filter(p=>p.destacado!==false)); applyFilters(); renderReviews(); document.body.addEventListener('click',(e)=>{ const btn=e.target.closest('[data-open]'); if(btn){ openModal(btn.getAttribute('data-open')); } }); }
    document.addEventListener('DOMContentLoaded', init);

    // ==== PRUEBAS R√ÅPIDAS (no invasivas) ====
    (function selfTest(){ try{ console.assert(typeof RemoteStore.enabled==='function', 'RemoteStore OK'); console.assert(Array.isArray(REVIEWS) && REVIEWS.length===7, 'Reviews length OK'); console.assert(typeof CATALOGOS === 'object', 'Cat√°logos OK'); }catch(err){ console.warn('SelfTest:', err); } })();
  </script>
</body>
</html>
